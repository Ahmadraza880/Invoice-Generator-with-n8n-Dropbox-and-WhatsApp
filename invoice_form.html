<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice Request Form</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .error {
      color: #dc2626;
      font-size: 0.875rem;
      margin-top: 0.25rem;
      display: none;
    }
    .input-error {
      border-color: #dc2626 !important;
    }
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Invoice Request Form</h2>
    <form id="invoiceForm" action="https://d7bc58b2a566.ngrok-free.app/webhook-test/invoice" method="POST" class="space-y-4">
      <div>
        <label for="clientName" class="block text-sm font-medium text-gray-700">Client Name</label>
        <input type="text" id="clientName" name="clientName" required
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
               placeholder="Enter client name">
        <span id="clientNameError" class="error">Please enter a valid name (letters and spaces only)</span>
      </div>

      <div>
        <label for="clientPhone" class="block text-sm font-medium text-gray-700">Client Phone (with country code)</label>
        <input type="text" id="clientPhone" name="clientPhone" required
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
               placeholder="+14155552671">
        <span id="clientPhoneError" class="error">Please enter a valid phone number (e.g., +1234567890)</span>
      </div>

      <div>
        <label for="itemDescription" class="block text-sm font-medium text-gray-700">Item Description</label>
        <input type="text" id="itemDescription" name="itemDescription" required
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
               placeholder="Enter item description">
        <span id="itemDescriptionError" class="error">Please enter a valid description</span>
      </div>

      <div>
        <label for="itemQty" class="block text-sm font-medium text-gray-700">Quantity</label>
        <input type="number" id="itemQty" name="itemQty" required min="1"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
               placeholder="Enter quantity">
        <span id="itemQtyError" class="error">Please enter a quantity greater than 0</span>
      </div>

      <div>
        <label for="itemPrice" class="block text-sm font-medium text-gray-700">Price per Item (USD)</label>
        <input type="number" id="itemPrice" name="itemPrice" required min="0" step="0.01"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
               placeholder="Enter price">
        <span id="itemPriceError" class="error">Please enter a valid price</span>
      </div>

      <div>
        <label for="totalPrice" class="block text-sm font-medium text-gray-700">Total Price (USD)</label>
        <input type="text" id="totalPrice" name="totalPrice" readonly
               class="mt-1 block w-full rounded-md border-gray-300 bg-gray-100 shadow-sm"
               value="0.00">
      </div>

      <div class="flex items-center">
        <input type="checkbox" id="applyDiscount" name="applyDiscount"
               class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
        <label for="applyDiscount" class="ml-2 block text-sm text-gray-700">Apply Discount (33% off with valid code)</label>
      </div>

      <div id="discountSection" class="hidden">
        <label for="discountCode" class="block text-sm font-medium text-gray-700">Discount Code</label>
        <div class="flex space-x-2">
          <input type="text" id="discountCode" name="discountCode"
                 class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                 placeholder="Enter discount code">
          <button type="button" id="applyDiscountCode"
                  class="mt-1 bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition duration-200">
            Apply
          </button>
        </div>
        <span id="discountCodeError" class="error">Invalid discount code</span>
      </div>

      <button type="submit"
              class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition duration-200">
        Submit Invoice
      </button>
    </form>
    <div id="successMessage" class="hidden mt-4 p-4 bg-green-100 text-green-700 rounded-md text-center fade-in">
      Invoice submitted successfully!
    </div>
  </div>

  <script>
    const DISCOUNT_CODE = "WEGOINUP";
    const DISCOUNT_RATE = 0.33; // 33% discount
    let isDiscountValid = false;

    const invoiceForm = document.getElementById('invoiceForm');
    const itemQtyInput = document.getElementById('itemQty');
    const itemPriceInput = document.getElementById('itemPrice');
    const totalPriceInput = document.getElementById('totalPrice');
    const applyDiscountCheckbox = document.getElementById('applyDiscount');
    const discountSection = document.getElementById('discountSection');
    const discountCodeInput = document.getElementById('discountCode');
    const applyDiscountButton = document.getElementById('applyDiscountCode');

    function calculateTotal() {
      const qty = parseInt(itemQtyInput.value) || 0;
      const price = parseFloat(itemPriceInput.value) || 0;
      let total = qty * price;
      if (applyDiscountCheckbox.checked && isDiscountValid) {
        total *= (1 - DISCOUNT_RATE);
      }
      totalPriceInput.value = total.toFixed(2);
    }

    itemQtyInput.addEventListener('input', calculateTotal);
    itemPriceInput.addEventListener('input', calculateTotal);

    applyDiscountCheckbox.addEventListener('change', () => {
      discountSection.classList.toggle('hidden', !applyDiscountCheckbox.checked);
      if (!applyDiscountCheckbox.checked) {
        discountCodeInput.value = '';
        document.getElementById('discountCodeError').style.display = 'none';
        isDiscountValid = false;
      }
      calculateTotal();
    });

    applyDiscountButton.addEventListener('click', () => {
      document.getElementById('discountCodeError').style.display = 'none';
      discountCodeInput.classList.remove('input-error');
      
      if (discountCodeInput.value === DISCOUNT_CODE) {
        isDiscountValid = true;
      } else {
        isDiscountValid = false;
        discountCodeInput.classList.add('input-error');
        document.getElementById('discountCodeError').style.display = 'block';
      }
      calculateTotal();
    });

    invoiceForm.addEventListener('submit', function (e) {
      e.preventDefault();

      // Reset error states
      const inputs = ['clientName', 'clientPhone', 'itemDescription', 'itemQty', 'itemPrice', 'discountCode'];
      inputs.forEach(id => {
        const element = document.getElementById(id);
        const errorElement = document.getElementById(`${id}Error`);
        if (element && errorElement) {
          element.classList.remove('input-error');
          errorElement.style.display = 'none';
        }
      });

      // Validation
      let isValid = true;
      const clientName = document.getElementById('clientName').value;
      const clientPhone = document.getElementById('clientPhone').value;
      const itemDescription = document.getElementById('itemDescription').value;
      const itemQty = parseInt(itemQtyInput.value);
      const itemPrice = parseFloat(itemPriceInput.value);

      if (!/^[A-Za-z\s]+$/.test(clientName)) {
        document.getElementById('clientName').classList.add('input-error');
        document.getElementById('clientNameError').style.display = 'block';
        isValid = false;
      }
      if (!/^\+\d{10,15}$/.test(clientPhone)) {
        document.getElementById('clientPhone').classList.add('input-error');
        document.getElementById('clientPhoneError').style.display = 'block';
        isValid = false;
      }
      if (!itemDescription.trim()) {
        document.getElementById('itemDescription').classList.add('input-error');
        document.getElementById('itemDescriptionError').style.display = 'block';
        isValid = false;
      }
      if (itemQty <= 0) {
        document.getElementById('itemQty').classList.add('input-error');
        document.getElementById('itemQtyError').style.display = 'block';
        isValid = false;
      }
      if (itemPrice < 0) {
        document.getElementById('itemPrice').classList.add('input-error');
        document.getElementById('itemPriceError').style.display = 'block';
        isValid = false;
      }
      if (applyDiscountCheckbox.checked && !isDiscountValid) {
        document.getElementById('discountCode').classList.add('input-error');
        document.getElementById('discountCodeError').style.display = 'block';
        isValid = false;
      }

      if (isValid) {
        // Add total price and discount info to form data
        const formData = new FormData(this);
        formData.append('totalPrice', totalPriceInput.value);
        if (applyDiscountCheckbox.checked && isDiscountValid) {
          formData.append('discountApplied', '33%');
        }

        fetch('https://d7bc58b2a566.ngrok-free.app/webhook-test/invoice', {
               
          method: 'POST',
          body: formData,
          headers: { 'Accept': 'application/json' }
        })
        .then(response => {
          if (response.ok) {
            document.getElementById('successMessage').classList.remove('hidden');
            this.reset();
            totalPriceInput.value = '0.00';
            discountSection.classList.add('hidden');
            applyDiscountCheckbox.checked = false;
            isDiscountValid = false;
            setTimeout(() => {
              document.getElementById('successMessage').classList.add('hidden');
            }, 3000);
          }
        })
        .catch(error => {
          console.error('Form submission error:', error);
        });
      }
    });
  </script>
</body>
</html>